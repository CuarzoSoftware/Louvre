<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Louvre: Chapter 18: Tearing Control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Louvre<span id="projectnumber">&#160;v2.18.1-1</span>
   </div>
   <div id="projectbrief">C++ library for Wayland compositors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Chapter 18: Tearing Control</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a> defaults to using double buffering when rendering. This implies that each output utilizes two framebuffers: one displayed on the screen, and another where the subsequent frame is rendered. These buffers are then swapped, with the last rendered framebuffer now being displayed on the screen, and the other used for rendering, and so forth.</p>
<h1><a class="anchor" id="vsync"></a>
VSync</h1>
<p>When VSync is enabled, the framebuffer swapping occurs during a specific hardware event known as a vblank event. A vblank, or vertical blank, typically occurs after a fixed period determined by the refresh rate of the current output mode. It happens when the hardware responsible for displaying your framebuffers on a display starts scanning out the current framebuffer and displaying it on the screen.</p>
<h1><a class="anchor" id="tearing"></a>
Tearing</h1>
<p>If you swap the framebuffers at any other time, you may notice that half or part of the screen displays the current framebuffer, while the other displays the previous one. This artifact is known as tearing, demonstrated in the following image:</p>
<p><img src="https://lh3.googleusercontent.com/2ousoWwxnVGvFX5bT6ual2G8UUbhUOJ21mK1UQmthPNM-7XfracRlL5GCYBQTzt4Os28eKO_FzC6BS-rasiNngvTMI9lEdET0ItKrI2wK_9IwSDaF-hNGkTMI6gVlL0m4ENDJYbckw" alt="" style="width:100%" class="inline"/></p>
<h1><a class="anchor" id="toggling-vsync"></a>
Toggling VSync</h1>
<p>In a typical scenario, you'd likely want VSync to be enabled. However, some gaming enthusiasts may prefer to disable it to achieve a faster screen response time and gain a few more FPS.</p>
<p>Once again, starting from version 1.2.0, <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a> supports toggling VSync on outputs. This can be accomplished through <a class="el" href="class_louvre_1_1_l_output.html#aad3bf6e06d340d3dc8d267e4e654afeb" title="Turns VSync on or off.">Louvre::LOutput::enableVSync()</a>. Disabling it is not universally supported and depends on your GPU hardware and drivers. To check if an output supports it, you can use <a class="el" href="class_louvre_1_1_l_output.html#ab37de15dd67cb6861eface25a2c1498b" title="Checks if VSync control is supported for this output.">Louvre::LOutput::hasVSyncControlSupport()</a>. In cases where it is unsupported, VSync is always enabled.</p>
<h1><a class="anchor" id="refresh-rate-limit"></a>
Refresh Rate Limit</h1>
<p>When you disable VSync on a specific output, <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a> defaults to limiting its refresh rate to twice the native refresh rate determined by its current mode. This precaution is taken because disabling the limit could unnecessarily consume processing power and even diminish the overall performance of your system.</p>
<p>To set a custom refresh rate limit when VSync is disabled, you can use <a class="el" href="class_louvre_1_1_l_output.html#af1564c3c6d1b77f089702e01ec4502d9" title="Sets the refresh rate limit in Hz when VSync is disabled.">Louvre::LOutput::setRefreshRateLimit()</a>. If you pass a value of -1, the limit is disabled. If you pass a value of 0, the limit is set to double the actual refresh rate of your output. Any other value represents the desired limit in Hz.</p>
<h1><a class="anchor" id="client-control"></a>
Client Control</h1>
<p>Clients using the <a href="https://wayland.app/protocols/tearing-control-v1">Tearing Control</a> protocol can communicate their preference for enabling or disabling VSync for a particular surface to the compositor. To check if a surface prefers VSync, you can use <a class="el" href="class_louvre_1_1_l_surface.html#ac8212dc8e0490f5dd5671187b07f0773" title="Gets the VSync preference of the client for this surface.">Louvre::LSurface::preferVSync()</a> and be notified when this property changes through the <a class="el" href="class_louvre_1_1_l_surface.html#a17d11b10d54f0f54fbb8ad6020c135f6" title="Notifies about changes in the VSync preference.">Louvre::LSurface::preferVSyncChanged()</a> virtual method. For clients not using this protocol, <a class="el" href="class_louvre_1_1_l_surface.html#ac8212dc8e0490f5dd5671187b07f0773" title="Gets the VSync preference of the client for this surface.">Louvre::LSurface::preferVSync()</a> always returns <code>true</code>.</p>
<p>Now, let's take a somewhat lazy approach and reuse our previous <code>findFullscreenToplevel()</code> in <a class="el" href="class_louvre_1_1_l_output.html#a0569e991ee4c6e4242578aca6d999741" title="Paint Event.">Louvre::LOutput::paintGL()</a> to toggle VSync based on the preference of the first fullscreen toplevel surface found on a given output.</p>
<h3><a class="anchor" id="srceoutputcpp-15"></a>
src/EOutput.cpp</h3>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EOutput::paintGL()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    EToplevel *fullscreenToplevel { findFullscreenToplevel() };</div>
<div class="line">    enableFractionalOversampling( fullscreenToplevel == <span class="keyword">nullptr</span>);</div>
<div class="line">    enableVSync(fullscreenToplevel == <span class="keyword">nullptr</span> ? <span class="keyword">true</span> : fullscreenToplevel-&gt;surf()-&gt;preferVSync());</div>
<div class="line">    G::scene()-&gt;handlePaintGL(<span class="keyword">this</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><p>To test if this is working, try launching <code>$ weston-simple-egl -t</code> (the <code>-t</code> argument makes the client prefer tearing), and then press <code>F11</code> to turn it into fullscreen mode. If you pay attention, you should be able to observe the tearing effect, and the logging messages from <em>weston-simple-egl</em> should indicate a refresh rate approximately double that of your screen's current mode. If not, your monitor likely lacks VSync control support.</p>
<p><img src="https://lh3.googleusercontent.com/pw/ABLVV84Qz7gTHDzk8h2jh_b0oHRnXi2ydfs2WzvAlCfhUH_SWWho6wCdw9_DmaXSKWmbvXl3283yfMPHU_kCCClkJoAMrRwn6c1nBVBoYOzNT1bT1bMxr7A=w2400" alt="" class="inline"/></p>
<p>Also, try experimenting with different values using <a class="el" href="class_louvre_1_1_l_output.html#af1564c3c6d1b77f089702e01ec4502d9" title="Sets the refresh rate limit in Hz when VSync is disabled.">Louvre::LOutput::setRefreshRateLimit()</a>. For instance, using <code>-1</code> to disable the limit, but keep in mind that this might be harsh on your eyes.</p>
<h2><a class="anchor" id="congratulations"></a>
Congratulations!</h2>
<p>We've covered the most crucial aspects of building a compositor with <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a>, and you may already be prepared to let your creativity soar.</p>
<p>If you encounter any bugs, have suggestions, questions, want to share your creations or contribute to the development of <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a>, please don't hesitate to get in touch. You can find our contact information on the <a href="md_md__contact.html">Contact</a> page.</p>
<p><a href="17.md">◀ Chapter 17: Fractional Scaling</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<script>
    var menu = false;
    var burger, nav;
    function resp()
    {
        if (window.innerWidth < 768)
        {
            burger.hidden = false;
            nav.hidden = true;
        }
        else
        {
            burger.hidden = true;
            nav.hidden = false;
        }
        menu = false;
    }
    function toggleMenu()
    {
        nav.hidden = menu;
        menu = !menu;
    }
    window.onload = function()
    {
        if (typeof toggleLevel !== "undefined")
            toggleLevel(2);
        // Get all <a> tags with the "el" class
        var elLinks = document.querySelectorAll('a.el');
        // Loop through the matched elements
        elLinks.forEach(function(link) 
        {
            // Replace "Louvre::" with an empty string in the text content
            link.textContent = link.textContent.replace(/Louvre::/g, '');
        });
        nav = document.getElementById('main-nav');
        burger = document.createElement('div');
        burger.style.position = 'absolute';
        burger.style.top = '14px';
        burger.style.right = burger.style.top;
        burger.innerHTML = '<svg onclick="toggleMenu()" height="32px" viewBox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>';
        document.getElementById('top').appendChild(burger);
        resp();
    };
    window.onresize = function()
    {
        resp();
    };
</script>
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">Project developed by <a href="https://github.com/CuarzoSoftware"><img class="footer" src="https://avatars.githubusercontent.com/u/29326763?s=200&v=4" style="margin-left:2px;position:relative;top:-1px;width:12px;height:12px" alt="cuarzo"/> Cuarzo Software</a></li>
    </ul>
</div>